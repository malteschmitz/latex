% common packages

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{aurical}
\usepackage{mathptmx}
\usepackage[scaled]{helvet}
\usepackage{lmodern}
\usepackage{textcomp}
\usepackage{DejaVuSansMono}

\usepackage[ngerman]{babel}
\usepackage[german=guillemets]{csquotes}

\usepackage{amsmath}
\usepackage{nicefrac}

\usepackage{tikz}
\usetikzlibrary{positioning,%
  shapes.geometric,%
  shapes.misc,%
  calc,%
  fit,%
  decorations,%
  decorations.pathreplacing,%
  backgrounds,%
  arrows,%
  automata,%
  trees%
}

\usepackage{pifont}
\newcommand{\goodmark}{\textcolor<presentation>{green!50!black}{\Pisymbol{pzd}{52}}}
\newcommand{\badmark}{\textcolor<presentation>{red}{\Pisymbol{pzd}{56}}}

% define colors used by presentation theme AND article
\xdefinecolor{bordeaux}{RGB}{128,0,50}
\xdefinecolor{niceblue}{RGB}{13,41,79}
\xdefinecolor{nicegreen}{RGB}{13,79,18}
\xdefinecolor{niceviolet}{RGB}{79,13,74}
\colorlet{maincolor}{orange}
\colorlet{alertedcolor}{red}
\colorlet{examplecolor}{green!50!black}
\usetheme{latex}

% color system
% - color!9 used as light fill color (e.g. for block content)
% - color!18 used as default fill color (e.g. for state)
% - color!30 used as highlight fill color (e.g. for block header)
% - color!50 used as strong highlight fill color (e.g. for header row)

\usepackage{listings}
\lstdefinelanguage[MyLaTeX]{TeX}[LaTeX]{TeX}%
  % TeX commands
  {moretexcs={enquote,includegraphics,%
    part,chapter,section,subsection,paragraph,subparagraph%
    tableofcontents,listoffigures,listoftables,maketitle,%
    subsection,subsubsection,paragraph,autoref,it,%
    textcolor,colorbox,xdefinecolor,colorlet,foreach,%
    rowcolors,rowcolor,lstdefinestyle,lstset,KOMAoptions,%
    setkomavar,opening,closing,encl,%
    lehead,cehead,rehead,lefoot,cefoot,refoot,%
    lohead,cohead,rohead,lofoot,cofoot,rofoot,%
    ohead,chead,ihead,ofoot,cfoot,ifoot,%
    areaset,color,%
    automark,manualmark,markright,markboth,%
    tableofcontents,url,clearscrheadfoot,pagemark,headmark,%
    setheadtopline,setkomafont,setheadsepline,setfootsepline,%
    setfootbotline,chaptermark},%
  % LaTeX environments
  morekeywords={[2]lstlisting,document,letter,center,flushleft,%
    flushright,align,itemize,enumerate,description,tabular,
    titlepage,figure%
    },%
  % other things (like packages) to highlight
  morekeywords={[3]listings,textcomp,courier,xcolor,scrartcl,%
    scrlttr2,inputenc,babel,%
    fontenc,lmodern,mathptmx,%
    helvet,geometry,scrpage2,scrreprt,scrbook,%
    article,report,book,hyperref,%
    csquotes,amsmath,amssymb,la},
  alsoletter={0123456789}
  }%

\lstdefinelanguage{BibTeX}
  {keywords={%
      @article,@book,@collectedbook,@conference,@electronic,@ieeetranbstctl,%
      @inbook,@incollectedbook,@incollection,@injournal,@inproceedings,%
      @manual,@mastersthesis,@misc,@patent,@periodical,@phdthesis,@preamble,%
      @proceedings,@standard,@string,@techreport,@unpublished%
      },
   comment=[l][\itshape]{@comment},
   morekeywords={[2]author,title,year,publisher,editor,booktitle,journal,series,volume,number,pages,institution,note,howpublished},
  }

\lstset{%
  basicstyle=\scriptsize\ttfamily,%
  language=[MyLaTeX]TeX,%
  texcsstyle=*\color{violet}\bfseries,%
  keywordstyle=\color{violet}\bfseries,%
  keywordstyle={[2]\color{green!70!black}\bfseries},%
  keywordstyle={[3]\color{maincolor!70!black}\bfseries},%
  commentstyle=\color{gray}\itshape,%
  stringstyle=\itshape,%
  numbers=none,%
  frame=lines,%
  backgroundcolor=\color{maincolor!10},%
  rulecolor=\color{maincolor!70},%
  framerule=1pt,%
  showstringspaces=false,%
  upquote=true,%
  framexleftmargin=3pt,%
  framexrightmargin=3pt}

\lstdefinestyle{pseudo}{language={},%
  basicstyle=\normalfont,%
  morecomment=[l]{//},%
  morekeywords={for,to,while,do,if,then,else},%
  mathescape=true,%
  columns=fullflexible}

\lstdefinestyle{block}{%
  backgroundcolor={},%
  frame=no,%
  aboveskip=0pt,%
  belowskip=0pt
}

% german umlauts and red braces
\lstset{
  literate={ö}{{\"o}}1
           {Ö}{{\"O}}1
           {ä}{{\"a}}1
           {Ä}{{\"A}}1
           {ü}{{\"u}}1
           {Ü}{{\"U}}1
           {ß}{{\ss}}1
           {\{}{{\textbf{\color{red}\{}}}1
           {\}}{{\textbf{\color{red}\}}}}1
           {[}{{\textbf{\color{red}[}}}1
           {]}{{\textbf{\color{red}]}}}1
}

\usepackage{tabularx}

% zebra tables
\newcommand{\mainrowcolors}{\rowcolors{1}{maincolor!30}{maincolor!9}}
\newenvironment{zebratabular}{\mainrowcolors\begin{tabular}}{\end{tabular}}
\newcommand{\setrownumber}[1]{\global\rownum#1\relax}
\newcommand{\headerrow}{\rowcolor{maincolor!50}\setrownumber1}

\AtBeginDocument{\hypersetup{
  pdftitle={\titlestring},
  pdfauthor={\authorstring}}
  \title[\shorttitlestring]{\titlestring}
  \author[\shortauthorstring]{\authorstring}
  \date{\datestring}}

% set texts used later
\newcommand{\targetsname}{Ziele dieses Vortrags}
\newcommand{\targetscontentname}{Ziele und Inhalt}
\newcommand{\outlinename}{Gliederung}

% often used sets
\newcommand{\set}[1]{\mathbb{#1}}
\newcommand{\R}{\set{R}}
\newcommand{\N}{\set{N}}
\newcommand{\Z}{\set{Z}}
\newcommand{\Q}{\set{Q}}

% easier use of operatorname
\newcommand{\op}[1]{\operatorname{#1}}

% display vectors in bold
\let\oldvec\vec
\let\vec\boldsymbol

\newcommand{\xxx}{\only<presentation>{\vskip1em}}

\newcommand{\inhead}[1]{\textbf{\color{maincolor}#1}}

\newenvironment{mybib}{%
  % temporary disable \section command to get rid of bibliography heading
  \renewcommand{\chapter}[2]{}
  \begin{thebibliography}{10}
}{%
  \end{thebibliography}
}

% load logo collection from "Die TeXnische Komödie"
\usepackage{dtklogos}

% load common user macros
\input{macros.tex}







% set options for article
\mode
<article>

\newcommand{\itemref}[1]{#1}
\newcommand{\term}[1]{#1}

\KOMAoption{fontsize}{12pt}
\KOMAoption{parskip}{half}
\KOMAoption{open}{any}
\KOMAoption{headings}{big}
\KOMAoption{numbers}{noendperiod}
\KOMAoption{twoside}{false}
\KOMAoption{mpinclude}{true}

\usepackage{paralist}
% use compactitem as default itemize environment
\newenvironment{looseitemize}{}{}
\let\looseitemize\itemize
\let\endlooseitemize\enditemize
\let\itemize\compactitem
\let\enditemize\endcompactitem
% use compactenum as default enumerate environment
\newenvironment{looseenumerate}{}{}
\let\looseenumerate\enumerate
\let\endlooseenumerate\endenumerate
\let\enumerate\compactenum
\let\endenumerate\endcompactenum

% create head and foot line
\usepackage{scrpage2}
\pagestyle{scrheadings}

% stretch headline above margin (scrguide -- page 244)
\setheadwidth[0pt]{textwithmarginpar}

% create targets block
\usepackage{minitoc}
\nomtcrule
\ktightmtctrue
\tightmtctrue
\setlength{\mtcindent}{0pt}
\mtcsetfont{minitoc}{*}{\normalsize\rmfamily\upshape\mdseries}
\mtcsetfont{minitoc}{section}{\normalsize\rmfamily\upshape\mdseries}
\mtcsetfont{minitoc}{subsection}{\normalsize\rmfamily\upshape\mdseries}
\mtcsettitlefont{minitoc}{\normalsize\sffamily\upshape\bfseries}

\makeatletter
\newcommand{\targets}[1]{
  \parbox[t]{0.46\textwidth}{\raggedright
    \kern-0.8\baselineskip\nopagebreak[4]%
    \par\noindent %%
    \begin{tabular}{@{}p{\columnwidth}@{}}
    \reset@font\mtifont\do@mtitc{\mtc@v\targetsname}\\
    \end{tabular}%
    \begin{mtc@verse}{\mtcoffset}
    \begin{enumerate}#1\end{enumerate}
    \end{mtc@verse}
  }
  \hskip0.04\textwidth
  \parbox[t]{0.48\textwidth}{\raggedright
    \minitoc
  }
  % emulate two frames
  \addtocounter{slidenumber}{2}
  \addtocounter{framenumber}{2}
}
\makeatother

% keep the name of the current chapter and the current section

\clearscrheadfoot % clear all default settings
\automark[chapter]{section} % \automark[\rightmark]{\leftmark}

\ihead{\shorttitlestring\ \rightmark\ \textcolor{maincolor}{\bfseries |} \leftmark \hfill \pagemark}
\setkomafont{pageheadfoot}{\normalfont\sffamily}
\setkomafont{pagenumber}{\usekomafont{pageheadfoot}\color{maincolor}}
\setheadsepline{0.5pt}[\color{maincolor}]


% Create own counter as replacement for framenumber. framenumber is
% incremented in article mode as \refstepcounter{framenumber} by
% beamer and hyperref complains about duplicated targets if framenumber
% gets resetted after each chapter.
\newcounter{slidenumber}

\makeatletter
% create AtBeginChapter analog to AtBeginDocument
\def\AtBeginChapter{\g@addto@macro\@beginchapterhook}

\@onlypreamble\AtBeginChapter

\let\oldchapter\chapter
\long\def\chapter{\@beginchapterhook
  \oldchapter}
  
\ifx\@beginchapterhook\@undefined
  \let\@beginchapterhook\@empty
\fi
\makeatother

% slidenumbers starts over with every new chapter with 2 on chapterframe
\AtBeginChapter{\setcounter{slidenumber}{2}}

% hide block title in article mode
\setbeamertemplate{block begin}{}
\setbeamertemplate{block end}{}

% display block title in Block environment
\newenvironment{Block}{%
  \setbeamertemplate{block begin}[default]
  \setbeamertemplate{block end}[default]
  \begin{block}}{\end{block}}

% hide frame title and subtitle in article mode for default frame environment
\setbeamertemplate{frametitle}{}

% display frame title of Frame environment
\newenvironment{Frame}{%
  \setbeamertemplate{frametitle}{%
    \paragraph*{%
      \insertframetitle%
      \ifx\insertframesubtitle\empty\else%
        \newline%
        \mdseries\insertframesubtitle%
      \fi%
    }\ \par}
  \begin{frame}}{\end{frame}}

% hide effect of beameritemize
\newenvironment{beameritemize}{%
  \let\item\relax\ignorespaces}{%
  \ignorespacesafterend}
  
% map beamerenumerate to inparaenum
\newenvironment{beamerenumerate}{%
  \begin{inparaenum}\ignorespaces}{%
  \end{inparaenum}\ignorespacesafterend}

% map plain command to frame
\newcommand{\plain}[1]{\frame{#1}}

% display frame number
%\setbeamertemplate{frame end}{%
%  \marginpar{\hfill\scriptsize\sffamily\color{maincolor}$\to\,$\insertframenumber}}

% display framenumber as chapter number and slide number
\renewcommand{\insertframenumber}{\thechapter-\theslidenumber}

% incremend slide number
\setbeamertemplate{frame begin}{\stepcounter{slidenumber}}
% display slide number
\setbeamertemplate{frame end}{%
  \marginpar%
    [\scriptsize\sffamily\color{maincolor}\insertframenumber$\,\leftarrow$\hfill]%
    {\hfill\scriptsize\sffamily\color{maincolor}$\rightarrow\,$\insertframenumber}}
      
\newcommand{\script}{\addtomargin{Script}\mode<article>}
      
\usepackage{hyperref}
\hypersetup{breaklinks=true,
            pdfborder={0 0 0},
            pdfhighlight={/N}}

\usepackage{verbatim} % for the comment environment
















% Set options for beamer
\mode
<presentation>

\makeatletter
% Reverts "Heiko's fix for correct generation of section* and
% subsection* bookmarks" in beamerbasecompatibility.sty which
% disables bookmarks in \section* and \subsection*.
% This is done by disabling \Hy@writebookmark in \beamer@section
% and \beamer@subsection if their second argument is empty.
% This is the case for \section* and \subsection* as these
% commands are mapped to \beamer@section[{#1}]{} resp.
% \beamer@subsection[{#1}]{}. By defining \beamer@section and
% \beamer@subsection again to the original and not patched version
% in the macro \beamer@lastminutepatches where the patch is applied
% this behaviour gets disabled. This is mainly reverted because
% bookmarks of parts are not added after \section*{Conclusion} due
% to this patch.
\g@addto@macro\beamer@lastminutepatches{
  \ifx\org@beamer@section\undefined{}%
  \else
    \let\beamer@section\org@beamer@section{}%
  \fi
  \ifx\org@beamer@subsection\undefined{}%
  \else
    \let\beamer@subsection\org@beamer@subsection{}%
  \fi
}
\makeatother

% display framenumber as part number and frame number
\renewcommand{\insertframenumber}{\thepart-\theframenumber}

% reset frame number at the beginning of each chapter
\AtBeginPart{
  \setcounter{framenumber}{0}
}

\AtBeginSection[]{
  \input{sectionframe}
}

\newcommand{\chapter}[1]{
  \part{#1}
  \title{\LaTeX\\#1}
  \input{titleframes}
}

\newcommand{\itemref}[1]{\textbf{\color{maincolor}#1}}

\newcommand{\term}[1]{{\color{blue}#1}}
  
\newcommand{\targets}[1]{\section*{\targetscontentname}
  \frame[plain]{\frametitle{\targetsname}%
  \begin{enumerate}#1\end{enumerate}}
  \frame[plain]{\frametitle{\outlinename}\tableofcontents}}

% display math in serif font on the slides
\usefonttheme[onlymath]{serif}

% create new environment Block behaving exactly like block
\newenvironment{Block}{%
  \begin{block}}{\end{block}}

% create new environment Frame behaving exactly like frame in beamer mode
\newenvironment{Frame}[1][]{%
  \begin{frame}[environment=Frame,#1]}{\end{frame}}

% create new environment beameritemize behaving exactly like itemize
\newenvironment{beameritemize}{%
  \begin{itemize}}{\end{itemize}}

% create new environment beamerenumerate behaving exactly like enumerate
\newenvironment{beamerenumerate}{%
  \begin{enumerate}}{\end{enumerate}}


\mode
<all>
